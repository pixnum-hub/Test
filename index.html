<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Climate</title>

<style>
:root{
  --bg:#ffffff;
  --card:#f2f2f2;
  --text:#000;
  --sub:#555;
  --accent:#007aff;
}

body.dark{
  --bg:#121212;
  --card:#1c1c1e;
  --text:#fff;
  --sub:#aaa;
  --accent:#4da3ff;
}

body.oled{
  --bg:#000;
  --card:#0a0a0a;
  --text:#fff;
  --sub:#bbb;
  --accent:#4da3ff;
}

*{margin:0;padding:0;box-sizing:border-box;
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;}

body{
  background:var(--bg);
  color:var(--text);
  display:flex;
  justify-content:center;
  padding:20px;
  transition:.3s;
}

.app{
  width:100%;
  max-width:420px;
  display:flex;
  flex-direction:column;
  gap:20px;
}

.card{
  background:var(--card);
  border-radius:22px;
  padding:20px;
  text-align:center;
}

.app-title{font-size:28px;font-weight:700;}
.city{font-size:24px;font-weight:600;margin-top:6px;}
.location-detail{font-size:16px;color:var(--sub);}

input{
  width:100%;
  padding:12px;
  border-radius:14px;
  border:none;
  margin-top:10px;
  font-size:16px;
}

button{
  margin-top:10px;
  padding:12px;
  border-radius:14px;
  border:none;
  background:var(--accent);
  color:#fff;
  font-size:15px;
  cursor:pointer;
}

.temp{font-size:60px;font-weight:700;margin-top:10px;}

.section-title{font-size:20px;margin-bottom:10px;}

.scroll-row{
  display:flex;
  overflow-x:auto;
  gap:12px;
  scrollbar-width:none;
}
.scroll-row::-webkit-scrollbar{display:none;}

.forecast-item{
  min-width:85px;
  background:#1111;
  padding:12px;
  border-radius:14px;
  flex-shrink:0;
}

.forecast-time{font-size:14px;color:var(--sub);}
.forecast-temp{font-size:18px;font-weight:600;margin-top:5px;}
</style>
</head>

<body>

<div class="app">

<div class="card">
  <div class="app-title">Smart Climate</div>
  <div class="city" id="cityName">Loading...</div>
  <div class="location-detail" id="locationDetail"></div>
  <input id="searchInput" placeholder="Search city...">
  <button onclick="searchCity()">Search</button>
  <button onclick="toggleTheme()">Switch Theme</button>
</div>

<div class="card">
  <div class="temp" id="temp">--Â°C</div>
</div>

<div class="card">
  <div class="section-title">Next 24 Hours</div>
  <div id="hourly" class="scroll-row"></div>
</div>

<div class="card">
  <div class="section-title">7-Day Forecast</div>
  <div id="daily" class="scroll-row"></div>
</div>

<div class="card">
  <div class="section-title">24H Rain Forecast</div>
  <div id="rainHourly" class="scroll-row"></div>
</div>

<div class="card">
  <div class="section-title">Rain Summary</div>
  <div id="rainSummary"></div>
</div>

<div class="card">
  <div class="section-title">Air Quality</div>
  <div id="aqiData"></div>
</div>

<div class="card">
  <div class="section-title">Sunrise & Sunset</div>
  <div id="sunData"></div>
</div>

<div class="card">
  <div class="section-title">Comfort Index</div>
  <div id="comfortData"></div>
</div>

<div class="card">
  <div class="section-title">AC Recommendation</div>
  <div id="acAdvice"></div>
</div>

</div>

<script>

let themeIndex=0;
function toggleTheme(){
  document.body.classList.remove("dark","oled");
  themeIndex++;
  if(themeIndex==1) document.body.classList.add("dark");
  else if(themeIndex==2) document.body.classList.add("oled");
  else themeIndex=0;
}

function getCityName(lat,lon){
fetch(`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}`)
.then(res=>res.json())
.then(d=>{
 if(d.results){
  let r=d.results[0];
  cityName.innerText=r.name;
  locationDetail.innerText=r.admin1+", "+r.country;
 }
});
}

function searchCity(){
 let city=searchInput.value;
 fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`)
 .then(res=>res.json())
 .then(d=>{
   if(d.results){
    let lat=d.results[0].latitude;
    let lon=d.results[0].longitude;
    getCityName(lat,lon);
    loadWeather(lat,lon);
   }
 });
}

function loadWeather(lat,lon){

const weatherURL=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}
&current_weather=true
&hourly=temperature_2m,precipitation,relative_humidity_2m,dew_point_2m
&daily=temperature_2m_max,temperature_2m_min,sunrise,sunset,precipitation_sum
&timezone=auto`;

fetch(weatherURL)
.then(res=>res.json())
.then(data=>{

temp.innerText=Math.round(data.current_weather.temperature)+"Â°C";

hourly.innerHTML="";
for(let i=0;i<24;i++){
 hourly.innerHTML+=
 `<div class="forecast-item">
  <div class="forecast-time">${data.hourly.time[i].split("T")[1].slice(0,5)}</div>
  <div class="forecast-temp">${Math.round(data.hourly.temperature_2m[i])}Â°</div>
 </div>`;
}

daily.innerHTML="";
for(let i=0;i<7;i++){
 let date=new Date(data.daily.time[i]);
 daily.innerHTML+=
 `<div class="forecast-item">
  <div class="forecast-time">${date.toLocaleDateString('en',{weekday:'short'})}</div>
  <div class="forecast-temp">${Math.round(data.daily.temperature_2m_max[i])}Â°</div>
 </div>`;
}

rainHourly.innerHTML="";
let totalRain24=0;
for(let i=0;i<24;i++){
 let rain=data.hourly.precipitation[i]||0;
 totalRain24+=rain;
 let type="No Rain";
 if(rain>0 && rain<=0.5) type="Drizzle";
 else if(rain<=2) type="Light";
 else if(rain<=7) type="Moderate";
 else type="Heavy";
 rainHourly.innerHTML+=
 `<div class="forecast-item">
  <div class="forecast-time">${data.hourly.time[i].split("T")[1].slice(0,5)}</div>
  <div class="forecast-temp">${rain.toFixed(1)}mm</div>
  <div style="font-size:12px;color:var(--accent);">${type}</div>
 </div>`;
}

let totalRain7=0;
for(let i=0;i<7;i++) totalRain7+=data.daily.precipitation_sum[i]||0;

rainSummary.innerHTML=
`24H: ${totalRain24.toFixed(1)}mm<br>
7 Days: ${totalRain7.toFixed(1)}mm`;

let sunrise=new Date(data.daily.sunrise[0]);
let sunset=new Date(data.daily.sunset[0]);
sunData.innerHTML=
`ðŸŒ… ${sunrise.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}<br>
ðŸŒ‡ ${sunset.toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'})}`;

let humidity=data.hourly.relative_humidity_2m[0];
let dew=data.hourly.dew_point_2m[0];
let score=100;
if(data.current_weather.temperature>30) score-=20;
if(humidity>80) score-=20;
if(score<0) score=0;

comfortData.innerHTML=
`Humidity: ${humidity}%<br>
Dew Point: ${Math.round(dew)}Â°C<br>
Comfort Score: ${score}/100`;

let t=data.current_weather.temperature;
acAdvice.innerText=
t>=35?"Set AC 23â€“24Â°C":
t>=30?"Set AC 24â€“26Â°C":
"Natural ventilation recommended";

});

const airURL=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10,us_aqi&timezone=auto`;

fetch(airURL)
.then(r=>r.json())
.then(a=>{
aqiData.innerHTML=
`AQI: ${a.hourly.us_aqi[0]}<br>
PM2.5: ${a.hourly.pm2_5[0]}<br>
PM10: ${a.hourly.pm10[0]}`;
});
}

navigator.geolocation.getCurrentPosition(pos=>{
let lat=pos.coords.latitude;
let lon=pos.coords.longitude;
getCityName(lat,lon);
loadWeather(lat,lon);
});

</script>

</body>
</html>
