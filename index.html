<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pro GPS Tracker v2</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
:root{
 --bg:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
 --card:rgba(255,255,255,0.08);
 --text:#ffffff;
 --border:rgba(255,255,255,0.2);
}

.light{
 --bg:linear-gradient(135deg,#e3f2fd,#ffffff);
 --card:rgba(255,255,255,0.7);
 --text:#000;
 --border:rgba(0,0,0,0.2);
}

body{
 margin:0;
 font-family:Arial, sans-serif;
 background:var(--bg);
 display:flex;
 justify-content:center;
 align-items:center;
 min-height:100vh;
 color:var(--text);
}

.app-frame{
 width:95%;
 max-width:480px;
 background:var(--card);
 backdrop-filter:blur(20px);
 -webkit-backdrop-filter:blur(20px);
 border:1px solid var(--border);
 border-radius:25px;
 padding:20px;
 box-shadow:0 10px 40px rgba(0,0,0,0.3);
 position:relative;
 display:flex;
 flex-direction:column;
 align-items:center;
}

.toggle-mode{
 position:absolute;
 top:15px;
 right:15px;
 width:40px;
 height:40px;
 border-radius:50%;
 border:none;
 cursor:pointer;
 background:rgba(255,255,255,0.2);
 color:var(--text);
 font-size:18px;
 backdrop-filter:blur(10px);
}

h2{
 margin-top:5px;
 text-align:center;
}

#map{
 width:100%;
 height:220px;
 border-radius:15px;
 margin:10px 0;
}

.stats{
 width:100%;
 display:flex;
 flex-direction:column;
 gap:8px;
 margin-bottom:10px;
}

.stat-row{
 display:flex;
 justify-content:space-between;
 padding:10px;
 background:rgba(255,255,255,0.1);
 border-radius:10px;
 font-size:14px;
}

button{
 width:100%;
 padding:10px;
 margin:5px 0;
 border:none;
 border-radius:10px;
 font-weight:bold;
 cursor:pointer;
}

.start{background:#00ff88;color:#000;}
.pause{background:#ffc107;color:#000;}
.stop{background:#ff4d4d;color:#fff;}
.save{background:#00aaff;color:#000;}

canvas{
 width:100%!important;
 background:rgba(0,0,0,0.2);
 border-radius:10px;
 margin-top:10px;
}

.footer{
 margin-top:15px;
 font-size:12px;
 text-align:center;
 opacity:0.8;
}
</style>
</head>
<body>

<div class="app-frame">

<button class="toggle-mode" onclick="toggleMode()">☀</button>

<h2>Pro GPS Tracker v2</h2>

<div id="map"></div>

<div class="stats">
 <div class="stat-row"><span>Trip Time</span><span id="timer">0 sec</span></div>
 <div class="stat-row"><span>Distance</span><span id="distance">0 km</span></div>
 <div class="stat-row"><span>Avg Speed</span><span id="avg">0 km/h</span></div>
 <div class="stat-row"><span>Max Speed</span><span id="max">0 km/h</span></div>
</div>

<button class="start" onclick="startTracking()">Start</button>
<button class="pause" onclick="pauseTracking()">Pause</button>
<button class="stop" onclick="stopTracking()">Stop</button>
<button class="save" onclick="saveTrip()">Save Trip</button>

<canvas id="speedChart"></canvas>

<div class="footer">
© Manik Roy <span id="year"></span>. All Rights Reserved.
</div>

</div>

<script>
// Dark / Light Toggle
function toggleMode(){
 document.body.classList.toggle("light");
}

// Auto year
document.getElementById("year").innerText=new Date().getFullYear();

// Map
let map=L.map('map').setView([20,77],5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);

let polyline=L.polyline([],{color:'lime'}).addTo(map);
let marker;

let watchId,startTime,timerInterval;
let totalDistance=0,maxSpeed=0,lastPos=null,paused=false;

let ctx=document.getElementById("speedChart").getContext("2d");
let chart=new Chart(ctx,{
 type:'line',
 data:{labels:[],datasets:[{label:'Speed',data:[],borderColor:'lime'}]},
 options:{plugins:{legend:{display:false}},scales:{x:{display:false},y:{beginAtZero:true}}}
});

function haversine(lat1,lon1,lat2,lon2){
 const R=6371;
 const dLat=(lat2-lat1)*Math.PI/180;
 const dLon=(lon2-lon1)*Math.PI/180;
 const a=Math.sin(dLat/2)**2+
 Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*
 Math.sin(dLon/2)**2;
 return R*2*Math.atan2(Math.sqrt(a),Math.sqrt(1-a));
}

function startTracking(){
 paused=false;
 startTime=Date.now();
 timerInterval=setInterval(()=>{
   document.getElementById("timer").innerText=
   Math.floor((Date.now()-startTime)/1000)+" sec";
 },1000);

 watchId=navigator.geolocation.watchPosition(pos=>{
   if(paused) return;

   let lat=pos.coords.latitude;
   let lon=pos.coords.longitude;
   let speed=pos.coords.speed?pos.coords.speed*3.6:0;

   if(lastPos)
     totalDistance+=haversine(lastPos.lat,lastPos.lon,lat,lon);

   lastPos={lat,lon};

   if(marker) marker.setLatLng([lat,lon]);
   else marker=L.marker([lat,lon]).addTo(map);

   polyline.addLatLng([lat,lon]);
   map.setView([lat,lon],18);

   if(speed>maxSpeed) maxSpeed=speed;

   document.getElementById("distance").innerText=
   totalDistance.toFixed(3)+" km";

   document.getElementById("max").innerText=
   maxSpeed.toFixed(2)+" km/h";

   document.getElementById("avg").innerText=
   (totalDistance/((Date.now()-startTime)/3600000)).toFixed(2)+" km/h";

   chart.data.labels.push('');
   chart.data.datasets[0].data.push(speed.toFixed(2));
   chart.update();

 },()=>alert("GPS Error"),{enableHighAccuracy:true});
}

function pauseTracking(){paused=!paused}

function stopTracking(){
 navigator.geolocation.clearWatch(watchId);
 clearInterval(timerInterval);
}

function saveTrip(){
 alert("Trip saved locally (Demo Mode)");
}
</script>

</body>
</html>