<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Weather AI</title>
<style>
:root{
  --bg-color:#000;
  --text-color:#fff;
  --card-bg:linear-gradient(145deg,#1a1a1a,#111);
  --transition:0.3s;
}
body{
  margin:0;
  font-family:system-ui,-apple-system,sans-serif;
  background:var(--bg-color);
  color:var(--text-color);
  transition:background var(--transition),color var(--transition);
}
.app{
  max-width:420px;
  margin:20px auto;
  padding:20px;
  border-radius:25px;
  background:var(--bg-color);
  box-shadow:0 0 30px rgba(255,255,255,0.05);
  transition:background var(--transition);
}
.heading{
  text-align:center;
  font-size:28px;
  font-weight:700;
  margin-bottom:20px;
}
.themeToggle{
  display:flex;
  justify-content:center;
  gap:10px;
  margin-bottom:20px;
}
.themeToggle button{
  padding:8px 15px;
  border-radius:20px;
  border:none;
  cursor:pointer;
  font-weight:600;
  background:#1c1c1e;
  color:white;
  transition:background var(--transition),color var(--transition);
}
.searchBox{
  display:flex;
  flex-direction:column;
  gap:15px;
}
.searchBox input,
.searchBox button{
  padding:18px;
  border-radius:40px;
  border:none;
  font-size:18px;
  background:#1c1c1e;
  color:white;
  outline:none;
  transition:background var(--transition),color var(--transition);
}
.searchBox button{font-weight:600;cursor:pointer;}
.locationTitle{text-align:center;font-size:20px;margin-top:10px;opacity:0.8;}
.mainTemp{text-align:center;font-size:80px;font-weight:700;margin-top:10px;}
.weatherIcon{text-align:center;font-size:60px;margin-top:5px;}
.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:15px;
  margin-top:10px;
}
.card{
  background:var(--card-bg);
  padding:20px;
  border-radius:25px;
  transition:background var(--transition);
}
.label{font-size:14px;opacity:0.7;}
.value{font-size:22px;margin-top:8px;font-weight:600;transition:color var(--transition);}
.footer{text-align:center;margin-top:30px;font-size:12px;opacity:0.6;}
.segment h3{
  margin-top:30px;
  margin-bottom:10px;
  font-size:20px;
  opacity:0.8;
  text-align:left;
}
/* AQI Colors */
.aqi-green{color:#009966;}
.aqi-yellow{color:#ffde33;}
.aqi-orange{color:#ff9933;}
.aqi-red{color:#cc0033;}
.aqi-purple{color:#660099;}
.aqi-maroon{color:#7e0023;}
.card.aqi-green{background:#003300;}
.card.aqi-yellow{background:#333300;}
.card.aqi-orange{background:#663300;}
.card.aqi-red{background:#330000;}
.card.aqi-purple{background:#330033;}
.card.aqi-maroon{background:#330019;}
</style>
</head>
<body>
<div class="app">

<div class="heading">üå§ Smart Weather AI</div>

<div class="themeToggle">
  <button onclick="setTheme('light')">Light</button>
  <button onclick="setTheme('dark')">Dark</button>
  <button onclick="setTheme('oled')">OLED Black</button>
</div>

<div class="searchBox">
<input type="text" id="cityInput" placeholder="Search city">
<button onclick="searchCity()">Search</button>
<button onclick="detectLocation()">üìç Use My Location</button>
</div>

<div class="locationTitle" id="locationInfo">Loading Kolkata...</div>
<div class="mainTemp" id="mainTemp">--</div>
<div class="weatherIcon" id="weatherIcon">üå§</div>

<!-- Segment: Weather & Comfort -->
<div class="segment">
<h3>Weather & Comfort</h3>
<div class="grid">
  <div class="card"><div class="label">Feels Like (¬∞C)</div><div class="value" id="feelsLike">--</div></div>
  <div class="card"><div class="label">Dew Point (¬∞C)</div><div class="value" id="dewPoint">--</div></div>
  <div class="card"><div class="label">Pressure (hPa)</div><div class="value" id="pressure">--</div></div>
  <div class="card"><div class="label">UV Index</div><div class="value" id="uvIndex">--</div></div>
</div>
</div>

<!-- Segment: Wind Details -->
<div class="segment">
<h3>Wind Details</h3>
<div class="grid">
  <div class="card"><div class="label">Wind (km/h)</div><div class="value" id="windValue">--</div></div>
  <div class="card"><div class="label">Wind Gust</div><div class="value" id="windGust">--</div></div>
  <div class="card"><div class="label">Wind Dir</div><div class="value" id="windDir">--</div></div>
</div>
</div>

<!-- Segment: Sun & Moon -->
<div class="segment">
<h3>Sun & Moon</h3>
<div class="grid">
  <div class="card"><div class="label">Sunrise</div><div class="value" id="sunrise">--</div></div>
  <div class="card"><div class="label">Sunset</div><div class="value" id="sunset">--</div></div>
  <div class="card"><div class="label">Moon Phase</div><div class="value" id="moonPhase">--</div></div>
</div>
</div>

<!-- Segment: Cloud & Visibility -->
<div class="segment">
<h3>Cloud & Visibility</h3>
<div class="grid">
  <div class="card"><div class="label">Cloud Cover (%)</div><div class="value" id="cloudCover">--</div></div>
  <div class="card"><div class="label">Visibility (km)</div><div class="value" id="visibility">--</div></div>
</div>
</div>

<!-- Segment: Air Quality -->
<div class="segment">
<h3>Air Quality</h3>
<div class="grid">
  <div class="card" id="aqiCard"><div class="label">AQI (US)</div><div class="value" id="aqiValue">--</div></div>
  <div class="card"><div class="label">PM2.5</div><div class="value" id="pm25Value">--</div></div>
  <div class="card"><div class="label">PM10</div><div class="value" id="pm10Value">--</div></div>
  <div class="card"><div class="label">NO‚ÇÇ</div><div class="value" id="no2Value">--</div></div>
</div>
</div>

<!-- Segment: Precipitation -->
<div class="segment">
<h3>Precipitation</h3>
<div class="grid">
  <div class="card"><div class="label">Rain (mm)</div><div class="value" id="rainValue">--</div></div>
  <div class="card"><div class="label">24h Rain</div><div class="value" id="rain24Value">--</div></div>
  <div class="card"><div class="label">7 Day Rain</div><div class="value" id="rain7Value">--</div></div>
</div>
</div>

<!-- Segment: Advice / Lifestyle -->
<div class="segment">
<h3>Advice / Lifestyle</h3>
<div class="grid">
  <div class="card"><div class="label">Recommended AC</div><div class="value" id="acAdvice">--</div></div>
  <div class="card"><div class="label">AI Advice</div><div class="value" id="aiAdvice">--</div></div>
</div>
</div>

<div class="footer">¬© Manik Roy <span id="year"></span>. All Rights Reserved.</div>
</div>

<script>
document.getElementById("year").innerText=new Date().getFullYear();

// Default city: Kolkata
const DEFAULT_LAT=22.5726, DEFAULT_LON=88.3639;

// Theme toggle
function setTheme(mode){
  if(mode==='light'){document.documentElement.style.setProperty('--bg-color','#f4f4f4');document.documentElement.style.setProperty('--text-color','#000');document.documentElement.style.setProperty('--card-bg','#e0e0e0');}
  else if(mode==='dark'){document.documentElement.style.setProperty('--bg-color','#000');document.documentElement.style.setProperty('--text-color','#fff');document.documentElement.style.setProperty('--card-bg','linear-gradient(145deg,#1a1a1a,#111)');}
  else if(mode==='oled'){document.documentElement.style.setProperty('--bg-color','#000');document.documentElement.style.setProperty('--text-color','#fff');document.documentElement.style.setProperty('--card-bg','#000');}
}

// Weather icon
function getWeatherIcon(code){
if(code===0)return"‚òÄÔ∏è";if(code<=3)return"‚õÖ";if(code<=48)return"üå´";if(code<=67)return"üåß";if(code<=77)return"üå®";if(code<=82)return"üå¶";if(code<=99)return"‚õà";return"üåç";
}

// AQI calculation
function calculateUSaqi(pm25){if(pm25<=12)return Math.round((50/12)*pm25);if(pm25<=35.4)return Math.round(((100-51)/(35.4-12))*(pm25-12)+51);if(pm25<=55.4)return Math.round(((150-101)/(55.4-35.4)*(pm25-35.4)+101));if(pm25<=150.4)return Math.round(((200-151)/(150.4-55.4)*(pm25-55.4)+151));return Math.round(pm25*2);}
function degToCardinal(deg){const dirs=["N","NE","E","SE","S","SW","W","NW"];return dirs[Math.round(deg/45)%8];}

// Load weather safely
async function loadWeather(lat,lon){
try{
const wRes=await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relative_humidity_2m,apparent_temperature,cloudcover,visibility,windspeed_10m,winddirection_10m&daily=precipitation_sum,sunrise,sunset&timezone=auto`);
const wData=await wRes.json();
const c=wData.current_weather;
const hour=0;
const temp=c?.temperature??0;
const wind=c?.windspeed??0;
const code=c?.weathercode??0;
const windDir=degToCardinal(c?.winddirection??0);
const humidity=wData.hourly?.relative_humidity_2m?.[hour]??0;
const feels=wData.hourly?.apparent_temperature?.[hour]??temp;
const cloud=wData.hourly?.cloudcover?.[hour]??0;
const vis=(wData.hourly?.visibility?.[hour]??10000)/1000;
const rain=wData.hourly?.precipitation?.[hour]??0;
const rain24=wData.hourly?.precipitation?.slice(Math.max(0,hour-23),hour+1).reduce((a,b)=>a+b,0);
const rain7=wData.daily?.precipitation_sum?.slice(0,7).reduce((a,b)=>a+b,0);
const sunrise=wData.daily?.sunrise?.[0]??"--";
const sunset=wData.daily?.sunset?.[0]??"--";

// Air Quality
const aRes=await fetch(`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10,nitrogen_dioxide&timezone=auto`);
const aData=await aRes.json();
const pm25=aData.hourly?.pm2_5?.[hour]??0;
const pm10=aData.hourly?.pm10?.[hour]??0;
const no2=aData.hourly?.nitrogen_dioxide?.[hour]??0;
const aqi=calculateUSaqi(pm25);

document.getElementById("mainTemp").innerText=temp+"¬∞C";
document.getElementById("windValue").innerText=wind;
document.getElementById("windDir").innerText=windDir;
document.getElementById("humidityValue").innerText=humidity;
document.getElementById("feelsLike").innerText=feels;
document.getElementById("cloudCover").innerText=cloud;
document.getElementById("visibility").innerText=vis.toFixed(1);
document.getElementById("rainValue").innerText=rain;
document.getElementById("rain24Value").innerText=rain24.toFixed(1);
document.getElementById("rain7Value").innerText=rain7?.toFixed(1)??0;
document.getElementById("sunrise").innerText=sunrise;
document.getElementById("sunset").innerText=sunset;
document.getElementById("weatherIcon").innerText=getWeatherIcon(code);
document.getElementById("pm25Value").innerText=pm25;
document.getElementById("pm10Value").innerText=pm10;
document.getElementById("no2Value").innerText=no2;
document.getElementById("aqiValue").innerText=aqi;

// AQI color
const aqiEl=document.getElementById("aqiValue"), aqiCard=document.getElementById("aqiCard");
aqiEl.className="value"; aqiCard.className="card";
if(aqi<=50){aqiEl.classList.add("aqi-green"); aqiCard.classList.add("aqi-green");}
else if(aqi<=100){aqiEl.classList.add("aqi-yellow"); aqiCard.classList.add("aqi-yellow");}
else if(aqi<=150){aqiEl.classList.add("aqi-orange"); aqiCard.classList.add("aqi-orange");}
else if(aqi<=200){aqiEl.classList.add("aqi-red"); aqiCard.classList.add("aqi-red");}
else if(aqi<=300){aqiEl.classList.add("aqi-purple"); aqiCard.classList.add("aqi-purple");}
else{aqiEl.classList.add("aqi-maroon"); aqiCard.classList.add("aqi-maroon");}

// Advice
document.getElementById("acAdvice").innerText=(temp>=30?"AC Recommended":"No AC needed");
document.getElementById("aiAdvice").innerText=(temp>35?"Hot. Stay hydrated. ":"")+ (aqi>100?"Air unhealthy. Wear mask.":"Air quality acceptable.");
}catch{document.getElementById("locationInfo").innerText="Weather fetch failed.";}
}

// Location detection
async function detectLocation(){
if(!navigator.geolocation){loadIP();return;}
navigator.geolocation.getCurrentPosition(async pos=>{
loadWeather(pos.coords.latitude,pos.coords.longitude);
},()=>loadIP());
}

// IP fallback
async function loadIP(){
try{
const res=await fetch("https://ipapi.co/json/");
const data=await res.json();
if(data.latitude && data.longitude){
document.getElementById("locationInfo").innerText=data.city+", "+data.country_name;
loadWeather(data.latitude,data.longitude);
return;
}
}catch{}
document.getElementById("locationInfo").innerText="Kolkata, India";
loadWeather(DEFAULT_LAT,DEFAULT_LON);
}

// Search city
async function searchCity(){
const city=document.getElementById("cityInput").value.trim();
if(!city)return;
document.getElementById("locationInfo").innerText="Searching...";
try{
const res=await fetch("https://geocoding-api.open-meteo.com/v1/search?name="+city);
const data=await res.json();
if(!data.results){document.getElementById("locationInfo").innerText="City not found";return;}
const {latitude,longitude,name,country}=data.results[0];
document.getElementById("locationInfo").innerText=name+", "+country;
loadWeather(latitude,longitude);
}catch{document.getElementById("locationInfo").innerText="City fetch failed";}
}

window.onload=()=>{detectLocation();};
</script>
</body>
</html>
