<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Weather AI</title>
<style>
:root{
  --bg-color:#000; --text-color:#fff; --card-bg:linear-gradient(145deg,#1a1a1a,#111); --transition:0.3s;
}
body{
  margin:0; font-family:system-ui,-apple-system,sans-serif; background:var(--bg-color); color:var(--text-color); transition:background var(--transition),color var(--transition);
}
.app{ max-width:420px; margin:20px auto; padding:20px; border-radius:25px; background:var(--bg-color); box-shadow:0 0 30px rgba(255,255,255,0.05); transition:background var(--transition);}
.heading{ text-align:center; font-size:28px; font-weight:700; margin-bottom:20px;}
.themeToggle{ display:flex; justify-content:center; gap:10px; margin-bottom:20px;}
.themeToggle button{ padding:8px 15px; border-radius:20px; border:none; cursor:pointer; font-weight:600; background:#1c1c1e; color:white; transition:background var(--transition),color var(--transition);}
.searchBox{ display:flex; flex-direction:column; gap:15px;}
.searchBox input, .searchBox button{ padding:18px; border-radius:40px; border:none; font-size:18px; background:#1c1c1e; color:white; outline:none; transition:background var(--transition),color var(--transition);}
.searchBox button{font-weight:600; cursor:pointer;}
.locationTitle{text-align:center;font-size:20px;margin-top:10px;opacity:0.8;}
.mainTemp{text-align:center;font-size:80px;font-weight:700;margin-top:10px;}
.weatherIcon{text-align:center;font-size:60px;margin-top:5px;}
.grid{ display:grid; grid-template-columns:1fr 1fr; gap:15px; margin-top:10px;}
.card{ background:var(--card-bg); padding:20px; border-radius:25px; transition:background var(--transition);}
.label{font-size:14px; opacity:0.7;}
.value{font-size:22px; margin-top:8px; font-weight:600; transition:color var(--transition);}
.footer{text-align:center; margin-top:30px; font-size:12px; opacity:0.6;}
.segment h3{ margin-top:30px; margin-bottom:10px; font-size:20px; opacity:0.8; text-align:left;}
.aqi-green{color:#009966;} .aqi-yellow{color:#ffde33;} .aqi-orange{color:#ff9933;} .aqi-red{color:#cc0033;} .aqi-purple{color:#660099;} .aqi-maroon{color:#7e0023;}
.card.aqi-green{background:#003300;} .card.aqi-yellow{background:#333300;} .card.aqi-orange{background:#663300;} .card.aqi-red{background:#330000;} .card.aqi-purple{background:#330033;} .card.aqi-maroon{background:#330019;}
.scrollContainer{ display:flex; overflow-x:auto; gap:10px; padding-bottom:10px;}
.scrollContainer::-webkit-scrollbar{ height:6px;}
.scrollContainer::-webkit-scrollbar-thumb{ background:#888; border-radius:3px;}
.tempCard{ min-width:60px; background:var(--card-bg); padding:10px; border-radius:15px; text-align:center; flex-shrink:0;}
.tempCard .hour{font-size:14px; opacity:0.7;} .tempCard .temp{font-size:18px; font-weight:600; margin-top:5px;}
</style>
</head>
<body>
<div class="app">

<div class="heading">üå§ Smart Weather AI</div>

<div class="themeToggle">
<button onclick="setTheme('light')">Light</button>
<button onclick="setTheme('dark')">Dark</button>
<button onclick="setTheme('oled')">OLED Black</button>
</div>

<div class="searchBox">
<input type="text" id="cityInput" placeholder="Search city">
<button onclick="searchCity()">Search</button>
<button onclick="detectLocation()">üìç Use My Location</button>
</div>

<div class="locationTitle" id="locationInfo">Loading Kolkata...</div>
<div class="mainTemp" id="mainTemp">--</div>
<div class="weatherIcon" id="weatherIcon">üå§</div>

<div class="segment">
<h3>24h Temperature</h3>
<div class="scrollContainer" id="temp24h"></div>
</div>

<div class="segment">
<h3>Weather Details</h3>
<div class="grid">
<div class="card"><div class="label">Feels-like (¬∞C)</div><div class="value" id="feelsValue">--</div></div>
<div class="card"><div class="label">Dew Point (¬∞C)</div><div class="value" id="dewValue">--</div></div>
<div class="card"><div class="label">Wind (km/h)</div><div class="value" id="windValue">--</div></div>
<div class="card"><div class="label">Wind Dir</div><div class="value" id="windDirValue">--</div></div>
<div class="card"><div class="label">Gust (km/h)</div><div class="value" id="gustValue">--</div></div>
<div class="card"><div class="label">Sunrise</div><div class="value" id="sunriseValue">--</div></div>
<div class="card"><div class="label">Sunset</div><div class="value" id="sunsetValue">--</div></div>
</div>
</div>

<div class="segment">
<h3>Air Quality</h3>
<div class="grid">
<div class="card" id="aqiCard"><div class="label">AQI (US)</div><div class="value" id="aqiValue">--</div></div>
<div class="card"><div class="label">PM2.5</div><div class="value" id="pm25Value">--</div></div>
<div class="card"><div class="label">PM10</div><div class="value" id="pm10Value">--</div></div>
<div class="card"><div class="label">NO‚ÇÇ</div><div class="value" id="no2Value">--</div></div>
</div>
</div>

<div class="segment">
<h3>Precipitation</h3>
<div class="grid">
<div class="card"><div class="label">Rain (mm)</div><div class="value" id="rainValue">--</div></div>
<div class="card"><div class="label">24h Rain</div><div class="value" id="rain24Value">--</div></div>
<div class="card"><div class="label">7 Day Rain</div><div class="value" id="rain7Value">--</div></div>
</div>
</div>

<div class="segment">
<h3>Advice / Lifestyle</h3>
<div class="grid">
<div class="card"><div class="label">Recommended AC</div><div class="value" id="acAdvice">--</div></div>
<div class="card"><div class="label">AI Advice</div><div class="value" id="aiAdvice">--</div></div>
</div>
</div>

<div class="footer">¬© Manik Roy <span id="year"></span>. All Rights Reserved.</div>
</div>

<script>
document.getElementById("year").innerText=new Date().getFullYear();
const DEFAULT_LAT=22.5726,DEFAULT_LON=88.3639,DEFAULT_CITY="Kolkata, India";

function setTheme(mode){
  if(mode==='light'){document.documentElement.style.setProperty('--bg-color','#f4f4f4');document.documentElement.style.setProperty('--text-color','#000');document.documentElement.style.setProperty('--card-bg','#e0e0e0');}
  else if(mode==='dark'){document.documentElement.style.setProperty('--bg-color','#000');document.documentElement.style.setProperty('--text-color','#fff');document.documentElement.style.setProperty('--card-bg','linear-gradient(145deg,#1a1a1a,#111)');}
  else if(mode==='oled'){document.documentElement.style.setProperty('--bg-color','#000');document.documentElement.style.setProperty('--text-color','#fff');document.documentElement.style.setProperty('--card-bg','#000');}
}

function getWeatherIcon(code){if(code===0)return"‚òÄÔ∏è";if(code<=3)return"‚õÖ";if(code<=48)return"üå´";if(code<=67)return"üåß";if(code<=77)return"üå®";if(code<=82)return"üå¶";if(code<=99)return"‚õà";return"üåç";}
function calculateUSaqi(pm25){if(pm25<=12)return Math.round((50/12)*pm25);if(pm25<=35.4)return Math.round(((100-51)/(35.4-12))*(pm25-12)+51);if(pm25<=55.4)return Math.round(((150-101)/(55.4-35.4)*(pm25-35.4)+101));if(pm25<=150.4)return Math.round(((200-151)/(150.4-55.4)*(pm25-55.4)+151));return Math.round(pm25*2);}
function degToCardinal(deg){const dirs=["N","NE","E","SE","S","SW","W","NW"];return dirs[Math.round(deg/45)%8];}
function safeValue(array,index){if(!array||array.length===0)return 0;let val=array[Math.min(index,array.length-1)];if(val===null||val===undefined)val=array.find(v=>v!==null&&v!==undefined)||0;return val;}

async function loadWeather(lat,lon){
  try{
    const weatherURL=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=temperature_2m,apparent_temperature,dewpoint_2m,windspeed_10m,winddirection_10m,windgusts_10m,precipitation&daily=sunrise,sunset,precipitation_sum&timezone=auto`;
    const airURL=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10,no2&timezone=auto`;

    const [weatherRes,airRes]=await Promise.all([fetch(weatherURL),fetch(airURL)]);
    const weatherData=await weatherRes.json();
    const airData=await airRes.json();

    const cw=weatherData.current_weather;
    const temp=cw.temperature;
    document.getElementById("mainTemp").innerText=temp+"¬∞C";
    document.getElementById("weatherIcon").innerText=getWeatherIcon(cw.weathercode);

    // Feels/Dew/Wind
    const nowIndex=0;
    document.getElementById("feelsValue").innerText=weatherData.hourly.apparent_temperature[nowIndex]+"¬∞C";
    document.getElementById("dewValue").innerText=weatherData.hourly.dewpoint_2m[nowIndex]+"¬∞C";
    document.getElementById("windValue").innerText=cw.windspeed;
    document.getElementById("windDirValue").innerText=degToCardinal(cw.winddirection);
    document.getElementById("gustValue").innerText=cw.windgust;
    document.getElementById("sunriseValue").innerText=weatherData.daily.sunrise[0].split("T")[1];
    document.getElementById("sunsetValue").innerText=weatherData.daily.sunset[0].split("T")[1];

    // Rain
    document.getElementById("rainValue").innerText=safeValue(weatherData.hourly.precipitation,nowIndex);
    document.getElementById("rain24Value").innerText=weatherData.daily.precipitation_sum[0];
    document.getElementById("rain7Value").innerText=weatherData.daily.precipitation_sum.slice(0,7).reduce((a,b)=>a+b,0);

    // AQI
    const pm25=safeValue(airData.hourly.pm2_5,nowIndex);
    document.getElementById("pm25Value").innerText=pm25;
    document.getElementById("pm10Value").innerText=safeValue(airData.hourly.pm10,nowIndex);
    document.getElementById("no2Value").innerText=safeValue(airData.hourly.no2,nowIndex);
    const aqi=calculateUSaqi(pm25);
    document.getElementById("aqiValue").innerText=aqi;
    const card=document.getElementById("aqiCard");
    card.className="card";
    if(aqi<=50)card.classList.add("aqi-green");
    else if(aqi<=100)card.classList.add("aqi-yellow");
    else if(aqi<=150)card.classList.add("aqi-orange");
    else if(aqi<=200)card.classList.add("aqi-red");
    else if(aqi<=300)card.classList.add("aqi-purple");
    else card.classList.add("aqi-maroon");

    // 24h temp scroll
    const temp24h=document.getElementById("temp24h");
    temp24h.innerHTML="";
    for(let i=0;i<24;i++){
      const hDiv=document.createElement("div");
      hDiv.className="tempCard";
      hDiv.innerHTML=`<div class="hour">${i}h</div><div class="temp">${safeValue(weatherData.hourly.temperature_2m,i)}¬∞C</div>`;
      temp24h.appendChild(hDiv);
    }

    // Advice placeholders
    document.getElementById("acAdvice").innerText="Set AC to 24¬∞C";
    document.getElementById("aiAdvice").innerText="No alerts";

  }catch(e){alert("Weather fetch failed.");console.log(e);}
}

async function searchCity(){
  const city=document.getElementById("cityInput").value;
  if(!city)return;
  try{
    const geoRes=await fetch(`https://geocoding-api.open-meteo.com/v1/search?name=${city}`);
    const geoData=await geoRes.json();
    if(!geoData.results){alert("City not found");return;}
    const loc=geoData.results[0];
    document.getElementById("locationInfo").innerText=`${loc.name}, ${loc.country}`;
    loadWeather(loc.latitude,loc.longitude);
  }catch(e){alert("Error fetching city data");console.log(e);}
}

function detectLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(pos=>{
      const lat=pos.coords.latitude;
      const lon=pos.coords.longitude;
      document.getElementById("locationInfo").innerText="Detecting...";
      loadWeather(lat,lon);
    },()=>loadIPLocation());
  }else loadIPLocation();
}

async function loadIPLocation(){
  try{
    const res=await fetch("https://ipapi.co/json/");
    const data=await res.json();
    const lat=data.latitude || DEFAULT_LAT;
    const lon=data.longitude || DEFAULT_LON;
    const city=data.city || "Kolkata";
    const country=data.country_name || "India";
    document.getElementById("locationInfo").innerText=`${city}, ${country}`;
    loadWeather(lat,lon);
  }catch(e){
    document.getElementById("locationInfo").innerText=DEFAULT_CITY;
    loadWeather(DEFAULT_LAT,DEFAULT_LON);
  }
}

// Auto load
window.onload=()=>{detectLocation()};
</script>
</body>
</html>
