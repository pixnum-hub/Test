<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Weather AI</title>

<style>
body{
  margin:0;
  background:#000;
  color:#fff;
  font-family: system-ui, -apple-system, sans-serif;
}

.app{
  max-width:420px;
  margin:auto;
  padding:20px;
}

.searchBox{
  display:flex;
  flex-direction:column;
  gap:15px;
}

.searchBox input{
  padding:18px;
  border-radius:40px;
  border:none;
  font-size:20px;
  background:#1c1c1e;
  color:white;
  outline:none;
}

.searchBox button{
  padding:18px;
  border-radius:40px;
  border:none;
  font-size:20px;
  font-weight:600;
  background:#1c1c1e;
  color:white;
  cursor:pointer;
}

.locationTitle{
  text-align:center;
  font-size:22px;
  margin-top:30px;
  opacity:0.8;
}

.mainTemp{
  text-align:center;
  font-size:90px;
  font-weight:700;
  margin-top:10px;
}

.weatherIcon{
  text-align:center;
  font-size:70px;
  margin-top:10px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
  margin-top:40px;
}

.card{
  background:linear-gradient(145deg,#1a1a1a,#111);
  padding:25px;
  border-radius:30px;
}

.label{
  font-size:18px;
  opacity:0.7;
}

.value{
  font-size:42px;
  margin-top:10px;
  font-weight:600;
}

.footer{
  text-align:center;
  margin-top:40px;
  font-size:14px;
  opacity:0.6;
}
</style>
</head>

<body>

<div class="app">

  <div class="searchBox">
    <input type="text" id="cityInput" placeholder="Search city">
    <button onclick="searchCity()">Search</button>
    <button onclick="detectLocation()">üìç Use My Location</button>
  </div>

  <div class="locationTitle" id="locationInfo">
    Loading location...
  </div>

  <div class="mainTemp" id="mainTemp">
    --
  </div>

  <div class="weatherIcon" id="weatherIcon">
    üå§
  </div>

  <div class="grid">
    <div class="card">
      <div class="label">AQI (US)</div>
      <div class="value" id="aqiValue">--</div>
    </div>

    <div class="card">
      <div class="label">Wind (km/h)</div>
      <div class="value" id="windValue">--</div>
    </div>

    <div class="card">
      <div class="label">Humidity (%)</div>
      <div class="value" id="humidityValue">--</div>
    </div>

    <div class="card">
      <div class="label">Rain (mm)</div>
      <div class="value" id="rainValue">--</div>
    </div>
  </div>

  <div class="footer">
    ¬© Manik Roy <span id="year"></span>. All Rights Reserved.
  </div>

</div>

<script>
document.getElementById("year").innerText = new Date().getFullYear();

/* Weather Icon */
function getWeatherIcon(code){
  if(code === 0) return "‚òÄÔ∏è";
  if(code <= 3) return "‚õÖ";
  if(code <= 48) return "üå´";
  if(code <= 67) return "üåß";
  if(code <= 77) return "üå®";
  if(code <= 82) return "üå¶";
  if(code <= 99) return "‚õà";
  return "üåç";
}

/* AQI estimate */
function getUSaqi(pm25){
  return Math.round(pm25 * 4);
}

/* Search city */
async function searchCity(){
  try{
    let city = document.getElementById("cityInput").value;
    if(!city) return;

    let geoRes = await fetch("https://geocoding-api.open-meteo.com/v1/search?name=" + city);
    let geoData = await geoRes.json();

    if(!geoData.results){
      alert("City not found");
      return;
    }

    let lat = geoData.results[0].latitude;
    let lon = geoData.results[0].longitude;
    let name = geoData.results[0].name;
    let country = geoData.results[0].country;

    document.getElementById("locationInfo").innerText =
      name + ", " + country;

    loadWeather(lat,lon);
  }catch(err){
    alert("Error fetching city data");
  }
}

/* GPS detect */
function detectLocation(){
  if(navigator.geolocation){
    navigator.geolocation.getCurrentPosition(async pos=>{
      let lat = pos.coords.latitude;
      let lon = pos.coords.longitude;

      document.getElementById("locationInfo").innerText = "Detecting...";

      let geoRes = await fetch(
        "https://geocoding-api.open-meteo.com/v1/reverse?latitude="+lat+"&longitude="+lon
      );
      let geoData = await geoRes.json();

      let name = "Your Location";
      let country = "";

      if(geoData.results){
        name = geoData.results[0].name;
        country = geoData.results[0].country;
      }

      document.getElementById("locationInfo").innerText =
        name + ", " + country;

      loadWeather(lat,lon);
    });
  }else{
    alert("GPS not supported");
  }
}

/* Load weather */
async function loadWeather(lat,lon){
  try{
    let weatherURL =
      "https://api.open-meteo.com/v1/forecast?latitude="+lat+
      "&longitude="+lon+
      "&current_weather=true"+
      "&hourly=relative_humidity_2m,precipitation"+
      "&timezone=auto";

    let airURL =
      "https://air-quality-api.open-meteo.com/v1/air-quality?latitude="+lat+
      "&longitude="+lon+
      "&hourly=pm2_5";

    let weatherRes = await fetch(weatherURL);
    let weatherData = await weatherRes.json();

    let airRes = await fetch(airURL);
    let airData = await airRes.json();

    let temp = weatherData.current_weather.temperature;
    let wind = weatherData.current_weather.windspeed;
    let code = weatherData.current_weather.weathercode;

    let humidity = weatherData.hourly.relative_humidity_2m[0];
    let rain = weatherData.hourly.precipitation[0];
    let pm25 = airData.hourly.pm2_5[0];

    document.getElementById("mainTemp").innerText = temp + "¬∞C";
    document.getElementById("windValue").innerText = wind;
    document.getElementById("humidityValue").innerText = humidity;
    document.getElementById("rainValue").innerText = rain;
    document.getElementById("aqiValue").innerText = getUSaqi(pm25);
    document.getElementById("weatherIcon").innerText = getWeatherIcon(code);

  }catch(err){
    alert("Weather data failed to load.");
  }
}

/* Auto load GPS on open */
window.onload = detectLocation;
</script>

</body>
</html>
