<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Advanced Weather & AQI App</title>

<style>
body{
margin:0;
font-family:Arial, sans-serif;
background:#0f172a;
color:white;
text-align:center;
}

h1{margin:15px 0;}

.container{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(260px,1fr));
gap:15px;
padding:15px;
}

.card{
background:#1e293b;
padding:15px;
border-radius:12px;
box-shadow:0 4px 10px rgba(0,0,0,0.3);
}

.bigTemp{
font-size:48px;
font-weight:bold;
}

.footer{
margin:20px;
opacity:0.7;
}

.loading{
opacity:0.6;
}

</style>
</head>
<body>

<h1>üåç Live Weather & AQI</h1>
<div id="locationInfo" class="loading">Detecting location...</div>

<div class="container">

<div class="card">
<div id="weatherIcon" style="font-size:40px;">‚õÖ</div>
<div class="bigTemp" id="mainTemp">--¬∞C</div>
<div>Wind: <span id="windValue">--</span> km/h</div>
<div>Humidity: <span id="humidityValue">--</span>%</div>
<div>Rain (now): <span id="rainValue">--</span> mm</div>
</div>

<div class="card">
<h3>üå´ AQI</h3>
<div id="aqiValue" style="font-size:28px;font-weight:bold;">--</div>
<div>PM2.5: <span id="pm25Value">--</span></div>
<div>PM10: <span id="pm10Value">--</span></div>
<div>NO‚ÇÇ: <span id="no2Value">--</span></div>
</div>

<div class="card" id="aqiAdvisoryCard">
<h3>üè• AQI Health Advisory</h3>
<div id="aqiCategory" style="font-weight:bold;margin-bottom:6px;"></div>
<div id="aqiHealthText"></div>
</div>

<div class="card">
<h3>üåß Rain Summary</h3>
<div>Last 24h: <span id="rain24Value">--</span> mm</div>
<div>Last 7 days: <span id="rain7Value">--</span> mm</div>
</div>

<div class="card">
<h3>‚ùÑ AC Recommendation</h3>
<div id="acAdvice">--</div>
<div id="aiAdvice"></div>
</div>

</div>

<div class="footer">¬© <span id="year"></span></div>

<script>
document.getElementById("year").innerText=new Date().getFullYear();

/* Weather Icons */
function getWeatherIcon(code){
if(code===0)return"‚òÄÔ∏è";
if(code<=3)return"‚õÖ";
if(code<=48)return"üå´";
if(code<=67)return"üåß";
if(code<=77)return"üå®";
if(code<=82)return"üå¶";
if(code<=99)return"‚õà";
return"üåç";
}

/* AQI Calculation */
function calculateUSaqi(pm25){
if(pm25<=12)return Math.round((50/12)*pm25);
if(pm25<=35.4)return Math.round(((100-51)/(35.4-12))*(pm25-12)+51);
if(pm25<=55.4)return Math.round(((150-101)/(55.4-35.4))*(pm25-35.4)+101);
if(pm25<=150.4)return Math.round(((200-151)/(150.4-55.4))*(pm25-55.4)+151);
if(pm25<=250.4)return Math.round(((300-201)/(250.4-150.4))*(pm25-150.4)+201);
return 301;
}

/* AQI Info */
function getAQIInfo(aqi){
if(aqi<=50){
return{color:"#00e400",label:"Good",
health:"Air quality is satisfactory.",
advice:"Enjoy outdoor activities."};
}
if(aqi<=100){
return{color:"#ffff00",label:"Moderate",
health:"Air quality acceptable for most people.",
advice:"Sensitive individuals should limit prolonged outdoor exertion."};
}
if(aqi<=150){
return{color:"#ff7e00",label:"Unhealthy for Sensitive Groups",
health:"Children, elderly, and respiratory patients may be affected.",
advice:"Limit outdoor activities if sensitive."};
}
if(aqi<=200){
return{color:"#ff0000",label:"Unhealthy",
health:"Everyone may begin to experience health effects.",
advice:"Avoid outdoor exercise. Wear a mask."};
}
if(aqi<=300){
return{color:"#8f3f97",label:"Very Unhealthy",
health:"Serious health effects possible.",
advice:"Stay indoors. Use air purifier."};
}
return{color:"#7e0023",label:"Hazardous",
health:"Health alert: emergency conditions.",
advice:"Remain indoors. Avoid all outdoor activity."};
}

function getCurrentHourIndex(times){
const now=new Date().toISOString().slice(0,13);
return times.findIndex(t=>t.startsWith(now));
}

function recommendedAC(temp){
if(temp>=35)return"Set AC to 24¬∞C";
if(temp>=30)return"Set AC to 25¬∞C";
if(temp>=25)return"Set AC to 26¬∞C";
return"No AC needed";
}

function estimatePower(temp){
if(temp>=35)return"High ‚ö°";
if(temp>=30)return"Medium ‚ö°";
if(temp>=25)return"Low ‚ö°";
return"Minimal";
}

function generateAdvice(temp,aqi){
let advice="";
if(temp>35)advice+="Extreme heat. Stay hydrated. ";
else if(temp>28)advice+="Warm weather. Light clothes. ";
else if(temp<10)advice+="Cold weather. Wear layers. ";

if(aqi>150)advice+="Air unhealthy. Wear mask.";
else if(aqi>80)advice+="Sensitive groups limit exposure.";
else advice+="Air quality acceptable.";

return advice;
}

/* Main Load */
async function loadWeather(lat,lon){
try{

let weatherURL=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relative_humidity_2m,precipitation&daily=precipitation_sum&timezone=auto`;

let airURL=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10,nitrogen_dioxide&timezone=auto`;

let weatherData=await(await fetch(weatherURL)).json();
let airData=await(await fetch(airURL)).json();

let temp=weatherData.current_weather.temperature;
let wind=weatherData.current_weather.windspeed;
let code=weatherData.current_weather.weathercode;

let hourIndex=getCurrentHourIndex(weatherData.hourly.time);
if(hourIndex<0)hourIndex=0;

let humidity=weatherData.hourly.relative_humidity_2m[hourIndex];
let rain=weatherData.hourly.precipitation[hourIndex];

let rain24=weatherData.hourly.precipitation.slice(Math.max(0,hourIndex-23),hourIndex+1).reduce((a,b)=>a+b,0);
let rain7=weatherData.daily.precipitation_sum.slice(0,7).reduce((a,b)=>a+b,0);

let airIndex=getCurrentHourIndex(airData.hourly.time);
if(airIndex<0)airIndex=0;

let pm25=airData.hourly.pm2_5[airIndex]||0;
let pm10=airData.hourly.pm10[airIndex]||0;
let no2=airData.hourly.nitrogen_dioxide[airIndex]||0;

let aqi=calculateUSaqi(pm25);
let aqiInfo=getAQIInfo(aqi);

/* Update AQI */
let aqiCard=document.getElementById("aqiValue");
aqiCard.innerText=aqi+" ("+aqiInfo.label+")";
aqiCard.style.color=aqiInfo.color;

let advisoryCard=document.getElementById("aqiAdvisoryCard");
advisoryCard.style.borderLeft="6px solid "+aqiInfo.color;

document.getElementById("aqiCategory").innerText=aqiInfo.label;
document.getElementById("aqiCategory").style.color=aqiInfo.color;
document.getElementById("aqiHealthText").innerText=
aqiInfo.health+" "+aqiInfo.advice;

/* Weather UI */
document.getElementById("mainTemp").innerText=temp+"¬∞C";
document.getElementById("windValue").innerText=wind;
document.getElementById("humidityValue").innerText=humidity;
document.getElementById("rainValue").innerText=rain;
document.getElementById("weatherIcon").innerText=getWeatherIcon(code);

document.getElementById("pm25Value").innerText=pm25;
document.getElementById("pm10Value").innerText=pm10;
document.getElementById("no2Value").innerText=no2;

document.getElementById("rain24Value").innerText=rain24.toFixed(1);
document.getElementById("rain7Value").innerText=rain7.toFixed(1);

document.getElementById("acAdvice").innerText=recommendedAC(temp);
document.getElementById("aiAdvice").innerText=
generateAdvice(temp,aqi)+" Power: "+estimatePower(temp);

document.getElementById("locationInfo").innerText="Location detected";

}catch{
document.getElementById("locationInfo").innerText="Weather fetch failed.";
}
}

/* Auto Location */
if(navigator.geolocation){
navigator.geolocation.getCurrentPosition(
pos=>loadWeather(pos.coords.latitude,pos.coords.longitude),
()=>document.getElementById("locationInfo").innerText="Location permission denied."
);
}else{
document.getElementById("locationInfo").innerText="Geolocation not supported.";
}
</script>

</body>
</html>
