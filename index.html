<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Live Weather & AQI Dashboard</title>

<style>
body{
font-family:Arial,Helvetica,sans-serif;
background:linear-gradient(135deg,#1e3c72,#2a5298);
color:#fff;
margin:0;
padding:0;
text-align:center;
}

header{
padding:20px;
font-size:28px;
font-weight:bold;
background:rgba(0,0,0,0.3);
}

.container{
padding:20px;
max-width:900px;
margin:auto;
}

.card{
background:rgba(255,255,255,0.1);
backdrop-filter:blur(10px);
border-radius:12px;
padding:20px;
margin:15px 0;
box-shadow:0 4px 10px rgba(0,0,0,0.3);
}

.big{
font-size:40px;
font-weight:bold;
}

button{
padding:10px 15px;
margin:5px;
border:none;
border-radius:6px;
cursor:pointer;
font-weight:bold;
}

input{
padding:10px;
border-radius:6px;
border:none;
width:60%;
max-width:300px;
}

footer{
margin-top:30px;
padding:15px;
font-size:14px;
opacity:0.8;
}
</style>
</head>

<body>

<header>ğŸŒ Live Weather & Air Quality Dashboard</header>

<div class="container">

<div class="card">
<input type="text" id="cityInput" placeholder="Enter city name">
<button onclick="searchCity()">Search</button>
<button onclick="manualRefresh()">Refresh</button>
</div>

<div id="locationInfo" class="card">ğŸ“ Detecting location...</div>

<div class="card">
<div id="weatherIcon" class="big">ğŸŒ</div>
<div id="mainTemp" class="big">--Â°C</div>
<div>Wind: <span id="windValue">--</span> km/h</div>
<div>Humidity: <span id="humidityValue">--</span>%</div>
<div>Rain (1h): <span id="rainValue">--</span> mm</div>
</div>

<div class="card">
<h3>ğŸŒ« Air Quality Index</h3>
<div id="aqiValue" class="big">--</div>
<div>
PM2.5: <span id="pm25Value">--</span> |
PM10: <span id="pm10Value">--</span> |
NOâ‚‚: <span id="no2Value">--</span>
</div>
</div>

<div class="card" id="aqiAdvisoryCard">
<h3>ğŸ¥ AQI Health Advisory</h3>
<div id="aqiCategory" style="font-weight:bold;"></div>
<div id="aqiHealthText"></div>
</div>

<div class="card">
<h3>ğŸŒ§ Rain Summary</h3>
<div>Last 24h: <span id="rain24Value">--</span> mm</div>
<div>Next 7 days: <span id="rain7Value">--</span> mm</div>
</div>

<div class="card">
<h3>â„ Smart AC Recommendation</h3>
<div id="acAdvice">--</div>
</div>

<div class="card">
<h3>ğŸ¤– AI Weather Advice</h3>
<div id="aiAdvice">--</div>
</div>

</div>

<footer>Â© <span id="year"></span> Weather Dashboard</footer>

<script>
document.getElementById("year").innerText=new Date().getFullYear();

let currentLat=null;
let currentLon=null;

/* Loading State */
function showLoading(){
document.getElementById("locationInfo").innerText="â³ Loading weather data...";
}

/* Weather Icon */
function getWeatherIcon(code){
if(code===0)return"â˜€ï¸";
if(code<=3)return"â›…";
if(code<=48)return"ğŸŒ«";
if(code<=67)return"ğŸŒ§";
if(code<=77)return"ğŸŒ¨";
if(code<=82)return"ğŸŒ¦";
if(code<=99)return"â›ˆ";
return"ğŸŒ";
}

/* AQI Calculation */
function calculateUSaqi(pm25){
if(pm25<=12)return Math.round((50/12)*pm25);
if(pm25<=35.4)return Math.round(((100-51)/(35.4-12))*(pm25-12)+51);
if(pm25<=55.4)return Math.round(((150-101)/(55.4-35.4))*(pm25-35.4)+101);
if(pm25<=150.4)return Math.round(((200-151)/(150.4-55.4))*(pm25-55.4)+151);
if(pm25<=250.4)return Math.round(((300-201)/(250.4-150.4))*(pm25-150.4)+201);
return 301;
}

/* AQI Info */
function getAQIInfo(aqi){
if(aqi<=50)return{color:"#00e400",label:"Good",
health:"Air quality is satisfactory.",
advice:"Enjoy outdoor activities."};
if(aqi<=100)return{color:"#ffff00",label:"Moderate",
health:"Air quality acceptable for most people.",
advice:"Sensitive individuals limit exposure."};
if(aqi<=150)return{color:"#ff7e00",label:"Unhealthy for Sensitive Groups",
health:"Children and elderly may be affected.",
advice:"Limit outdoor activities."};
if(aqi<=200)return{color:"#ff0000",label:"Unhealthy",
health:"Everyone may experience health effects.",
advice:"Avoid outdoor exercise. Wear mask."};
if(aqi<=300)return{color:"#8f3f97",label:"Very Unhealthy",
health:"Serious health effects possible.",
advice:"Stay indoors. Use purifier."};
return{color:"#7e0023",label:"Hazardous",
health:"Health alert conditions.",
advice:"Remain indoors."};
}

function getCurrentHourIndex(times){
const now=new Date().toISOString().slice(0,13);
return times.findIndex(t=>t.startsWith(now));
}

/* Fetch City Name */
async function getCityName(lat,lon){
let url=`https://geocoding-api.open-meteo.com/v1/reverse?latitude=${lat}&longitude=${lon}&language=en`;
let data=await(await fetch(url)).json();
if(data.results && data.results.length>0){
return data.results[0].name+", "+data.results[0].country;
}
return "Unknown Location";
}

/* Load Weather */
async function loadWeather(lat,lon){
showLoading();
currentLat=lat;
currentLon=lon;

try{
let weatherURL=`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true&hourly=relative_humidity_2m,precipitation&daily=precipitation_sum&timezone=auto`;
let airURL=`https://air-quality-api.open-meteo.com/v1/air-quality?latitude=${lat}&longitude=${lon}&hourly=pm2_5,pm10,nitrogen_dioxide&timezone=auto`;

let weatherData=await(await fetch(weatherURL)).json();
let airData=await(await fetch(airURL)).json();

let city=await getCityName(lat,lon);
document.getElementById("locationInfo").innerText="ğŸ“ "+city;

let temp=weatherData.current_weather.temperature;
let wind=weatherData.current_weather.windspeed;
let code=weatherData.current_weather.weathercode;

let hourIndex=getCurrentHourIndex(weatherData.hourly.time);
if(hourIndex<0)hourIndex=0;

let humidity=weatherData.hourly.relative_humidity_2m[hourIndex];
let rain=weatherData.hourly.precipitation[hourIndex];

let rain24=weatherData.hourly.precipitation.slice(Math.max(0,hourIndex-23),hourIndex+1).reduce((a,b)=>a+b,0);
let rain7=weatherData.daily.precipitation_sum.slice(0,7).reduce((a,b)=>a+b,0);

let airIndex=getCurrentHourIndex(airData.hourly.time);
if(airIndex<0)airIndex=0;

let pm25=airData.hourly.pm2_5[airIndex]||0;
let pm10=airData.hourly.pm10[airIndex]||0;
let no2=airData.hourly.nitrogen_dioxide[airIndex]||0;

let aqi=calculateUSaqi(pm25);
let aqiInfo=getAQIInfo(aqi);

/* Update UI */
document.getElementById("weatherIcon").innerText=getWeatherIcon(code);
document.getElementById("mainTemp").innerText=temp+"Â°C";
document.getElementById("windValue").innerText=wind;
document.getElementById("humidityValue").innerText=humidity;
document.getElementById("rainValue").innerText=rain;

document.getElementById("pm25Value").innerText=pm25;
document.getElementById("pm10Value").innerText=pm10;
document.getElementById("no2Value").innerText=no2;

document.getElementById("rain24Value").innerText=rain24.toFixed(1);
document.getElementById("rain7Value").innerText=rain7.toFixed(1);

document.getElementById("aqiValue").innerText=aqi+" ("+aqiInfo.label+")";
document.getElementById("aqiValue").style.color=aqiInfo.color;

document.getElementById("aqiCategory").innerText=aqiInfo.label;
document.getElementById("aqiCategory").style.color=aqiInfo.color;
document.getElementById("aqiHealthText").innerText=aqiInfo.health+" "+aqiInfo.advice;

document.getElementById("acAdvice").innerText=(temp>=30?"Set AC to 25Â°C":"No AC needed");
document.getElementById("aiAdvice").innerText=
(temp>30?"Stay hydrated. ":"")+
(aqi>150?"Wear mask outdoors. ":"Air quality acceptable.");

}catch{
document.getElementById("locationInfo").innerText="âŒ Failed to fetch weather.";
}
}

/* Search by City */
async function searchCity(){
let city=document.getElementById("cityInput").value;
if(!city)return;
showLoading();
let url=`https://geocoding-api.open-meteo.com/v1/search?name=${city}&count=1`;
let data=await(await fetch(url)).json();
if(data.results && data.results.length>0){
loadWeather(data.results[0].latitude,data.results[0].longitude);
}else{
document.getElementById("locationInfo").innerText="City not found.";
}
}

/* Manual Refresh */
function manualRefresh(){
if(currentLat && currentLon){
loadWeather(currentLat,currentLon);
}
}

/* Auto Detect */
if(navigator.geolocation){
navigator.geolocation.getCurrentPosition(
pos=>loadWeather(pos.coords.latitude,pos.coords.longitude),
()=>document.getElementById("locationInfo").innerText="Location permission denied."
);
}
</script>

</body>
</html>
